<!--
    This page has contact information for the admins of the system
    Created by: Alec Metcalfe
-->

<!DOCTYPE html>
<html>
<head>
    <title>SNACKS</title>

    <!-- Favicon setup for multiple devices -->
    <link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
    <link rel="manifest" href="./favicon/site.webmanifest">
    <link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" type="text/css" href="styles.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
</head>
<body>
    <!-- Bootstrap stuff -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

    <script src="navbar.js" type="text/javascript"></script>
    <script src="sidebar.js" type="text/javascript"></script>
    <script src="modal.js" type="text/javascript"></script>

    <!-- Sidebar -->
    <nav id="sidebar"></nav>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-primary" id="nav"></nav>

    <!-- Modal -->
    <div class="modal fade" id="ModalHelp" tabindex="-1" role="dialog" aria-labelledby="ModalHelpTitle" aria-hidden="true"></div>

    <div id="content">
      <button onclick="get_data()" type="button" id="build" class="btn btn-info" accesskey="b">
          <i class="fas fa-hammer"></i>
          <span>Build</span>
      </button>
      <div id="table_content">hello</div>
    </div>

    <div class="overlay">
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
      function get_data() {
        document.getElementById("table_content").innerHTML = "parsing url...";
        //var URL = require("./api-url.js").url;
        //var request = URL + "?sensor_id=original-things-uno";
        var request = "https://api.snacks.charlottetown.ca/v1/data?sensor_id=original-things-uno";
        document.getElementById("table_content").innerHTML = request;
        var xhr = new XMLHttpRequest();
        xhr.open('GET', request, true);
        //xhr.send({sensor_id:"original-things-uno"});
        xhr.send();
        xhr.onreadystatechange = processRequest;
        function processRequest(e)
        {
          if (xhr.readyState == 4 && xhr.status == 200)
          {
            //var table = buildHtmlTable(xhr.responseText);
            //document.getElementById("table_content").innerHTML = table;
            var data = JSON.parse(xhr.responseText);
            var col = [];
            for (var i = 0; i < data.length; i++) {
                for (var key in data[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }
            document.getElementById("table_content").innerHTML = "calculating columns...";

            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");

            document.getElementById("table_content").innerHTML = "creating table...";
            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

            var tr = table.insertRow(-1);                   // TABLE ROW.

            document.getElementById("table_content").innerHTML = "...";
            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

            document.getElementById("table_content").innerHTML = "adding data to rows...";

            // ADD JSON DATA TO THE TABLE AS ROWS.
            for (var i = 0; i < data.length; i++) {

                tr = table.insertRow(-1);

                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = data[i][col[j]];
                }
            }

            document.getElementById("table_content").innerHTML = "Creating container...";
            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
            var divContainer = document.getElementById("table_content");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
          }
          else
          {
            document.getElementById("table_content").innerHTML = "Please connect to the internet "+xhr.status.toString();
          }
        }
      }
    </script>
</body>
</html>
